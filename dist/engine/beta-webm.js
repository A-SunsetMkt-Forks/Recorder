/*
录音
https://github.com/xiangyuecn/Recorder
src: engine/beta-webm.js
*/
!function(e){var t="object"==typeof window&&!!window.document,n=(t?window:Object).Recorder,r=n.i18n;!function(b,e,l,v){"use strict";var R="audio/webm",y=v&&window.MediaRecorder&&MediaRecorder.isTypeSupported(R);b.prototype.enc_webm={stable:!1,getTestMsg:function(){return l(y?"tsTW::只有比较新的浏览器支持，压缩率和mp3差不多。由于未找到对已有pcm数据进行快速编码的方法，只能按照类似边播放边收听形式把数据导入到MediaRecorder，有几秒就要等几秒。输出音频虽然可以通过比特率来控制文件大小，但音频文件中的比特率并非设定比特率，采样率由于是我们自己采样的，到这个编码器随他怎么搞":"L49q::此浏览器不支持进行webm编码，未实现MediaRecorder")}},b.prototype.webm=function(e,r,t){if(v)if(y){var n=this.set,o=e.length,a=n.sampleRate,i=b.Ctx,c=i.createMediaStreamDestination();c.channelCount=1;var d=new MediaRecorder(c.stream,{mimeType:R,bitsPerSecond:1e3*n.bitRate}),s=[];d.ondataavailable=function(e){s.push(e.data)},d.onstop=function(e){var t=new Blob(s,{type:R}),n=new FileReader;n.onloadend=function(){r(n.result,R)},n.readAsArrayBuffer(t)},d.onerror=function(e){t(l("PIX0::转码webm出错：{1}",0,e.message))},d.start();for(var u=i.createBuffer(1,o,a),f=u.getChannelData(0),w=0;w<o;w++){var m=e[w];m=m<0?m/32768:m/32767,f[w]=m}var p=i.createBufferSource();p.channelCount=1,p.buffer=u,p.connect(c),p.start?p.start():p.noteOn(0),p.onended=function(){d.stop()}}else t(l("aG4z::此浏览器不支持把录音转成webm格式"));else t(l.G("NonBrowser-1",["webm encoder"]))}}(n,0,r.$T,t)}();